  {% load staticfiles i18n %}
  {% if date_total_sales %}
  {% block custom_css %}
   <style type="text/css">
    /* chart */
          canvas{
      -moz-user-select: none;
      -webkit-user-select: none;
      -ms-user-select: none;
    }
    .chartjs-tooltip {
      opacity: 1;
      position: absolute;
      background: rgba(0, 0, 0, .7);
      color: white;
      border-radius: 3px;
      -webkit-transition: all .1s ease;
      transition: all .1s ease;
      pointer-events: none;
      -webkit-transform: translate(-50%, 0);
      transform: translate(-50%, 0);
      padding: 4px;
    }

    .chartjs-tooltip-key {
      display: inline-block;
      width: 10px;
      height: 10px;
    }
    /* chart*/
  </style>
 {% endblock %}
  <div class="col-md-12">
   <div class="panel panel-flat">
    <div class="panel-heading">
        <h6 class="panel-title">Sale summary of Date {{date}}</h6>
        <div class="heading-elements">
          <ul class="icons-list">
            <li><a data-action="collapse"></a></li>
            <li><a data-action="reload"></a></li>
            <li><a data-action="close"></a></li>
          </ul>
        </div>
      <a class="heading-elements-toggle"><i class="icon-more"></i></a></div>

     <div class="panel-body">
          <!-- Quick stats boxes -->
          <div class="row animated fadeIn">
            <div class="col-lg-3">
              <!-- Date Sales -->
              <div class="panel bg-info-300">
                <div class="panel-body">
                  <div class="heading-elements">
                  </div>
                  <h4 class="no-margin">Total Sales</h4>
                  <h5 class="no-margin">KShs.{{date_total_sales}}</h5>
                  
                  {% if popular_item.count > 1%}
                  <div class="popular">
                   Popular products: <button class="btn btn-sm btn-default" onclick="alert('clicked ')" style="padding: 2px 5px;font-size: 10px;">View</button>
                 {{popular_item}}
                  </div>
                  {% else %}
                    <div class="popular">
                        Popular item: {% for p in popular_item %}{{p.product_name}} - ({{p.c}} sales) {% endfor %}
                  </div>
                  {% endif %}
                </div>

                <div id="server-load"></div>
              </div>
              <!-- /date sales -->
            </div>
            
            <div class="col-lg-3">
              <!-- Highest Sold -->
              <div class="panel bg-success-700">
                <div class="panel-body">
                  <div class="heading-elements">
                  </div>
                  <h4 class="no-margin">Highest Sold Item</h4>
                  <h5 class="no-margin">KShs. {{highest_item.total_cost__sum}}</h5>
                    <div class="high_product">
                    {{highest_item.product_name}}   
                    </div>
                </div>
                <div class="container-fluid">
                  <div id="members-online"></div>
                </div>
              </div>
              <!-- /highest sold -->
            </div>

            <div class="col-lg-3">
              <!-- Lowest Sold-->
              <div class="panel bg-danger-600">
                <div class="panel-body">
                  <div class="heading-elements">
                  </div>
                  <h4 class="no-margin">Lowest Sold Item</h4>
                  <h5 class="no-margin">KShs. {{lowest_item.total_cost__sum}}</h5>
                  <div class="low_product">
                  {{lowest_item.product_name}}   
                  </div>
                </div>
                <div class="container-fluid">
                  <div id="members-online"></div>
                </div>
              </div>
              <!-- /lowest sold -->
            </div>

            <div class="col-lg-3">
              <!-- Customers Visited -->
              <div class="panel bg-purple-600">
                <div class="panel-body">
                  <h4 class="no-margin">Customers</h4>
                  <h5 class="no-margin">{{no_of_customers}}</h5>
                  Customers Visited
                  <div class="any" style="visibility: hidden;">
                   1000 customers
                  </div>
                </div>
                <div class="container-fluid">
                  <div id="members-online"></div>
                </div>
              </div>
              <!-- /customers visited -->
            </div>

          </div>
          <!-- /quick stats boxes -->
     </div>
   </div>
 </div>

<div class="col-md-12">
   <div id="pagination-div">
    <div class="panel panel-flat">
      <div class="panel-body">
        <div class="row">

          <div class="col-md-12">

            <div class="col-md-10 col-md-offset-1">
                <canvas id="dateChart" width="900" height="400"></canvas>
                <div class="text-center"><span style="color: #72726d;">Hours in {{date}}</span></div>
            </div>

          </div>
        </div>

      </div>
    </div>
   </div><!--pagination div-->
  </div>

<div class="col-md-12">
  <div class="panel panel-flat">
    <div class="panel-body">
     <div class="row">
        <h3 style="padding-left: 20px;">Dail Gross Sales</h3>
     </div>
      <div class="row">    
          <div class="col-md-10">
              <div id="canvas-holder1" style="width:100%;">
                <canvas id="chart1"></canvas>
                <div class="chartjs-tooltip" id="tooltip-0"></div>
                <div class="chartjs-tooltip" id="tooltip-1"></div>
              </div>
          </div>
          <div class="col-md-2">
            <ul><li>yes</li><li>no</li></ul>
          </div>
      </div>
    </div>
  </div>
</div>
<div class="col-md-12">
<div class="row">
  <div class="col-md-4">
    <div class="panel panel-flat">
      <div class="panel-heading">
          <h6 class="panel-title">Top Items By Sales</h6>
          <div class="heading-elements">
            <ul class="icons-list">
              <li><a data-action="collapse"></a></li>
              <li><a data-action="reload"></a></li>
              <li><a data-action="close"></a></li>
            </ul>
          </div>
        <a class="heading-elements-toggle"><i class="icon-more"></i></a>
      </div>
      <div class="panel-body">
          <div class="data-table-container">
            <table class="table bordered highlight responsive data-table">
              <tbody>
                {% for item in top_items %}
                  <tr>
                    <td>
                      {{ forloop.counter }}
                    </td>
                    <td class="right-align">
                      {{ item.product_name }}
                    </td>
                    <td class="right-align">  
                      <div><span style="font-size: 0.7em;">Ksh.</span>{{ item.total_cost__sum }}</div>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
      </div>
    </div>
  </div>
  <div class="col-md-8">
    <div class="panel panel-flat">
      <div class="panel-heading">
          <h6 class="panel-title">Top Categories By Sales</h6>
          <div class="heading-elements">
            <ul class="icons-list">
              <li><a data-action="collapse"></a></li>
              <li><a data-action="reload"></a></li>
              <li><a data-action="close"></a></li>
            </ul>
          </div>
        <a class="heading-elements-toggle"><i class="icon-more"></i></a>
      </div>
      <div class="panel-body">
        <div class="col-md-6">
           <canvas id="catChart" width="400" height="400"></canvas>
        </div>
        <div class="col-md-6">
          <div class="data-table-container">
            <table class="table bordered highlight responsive data-table">
              <tbody>
              {% if sales_by_category %}
               {% for sales in sales_by_category %}
                  <tr data-action-go="">
                    <td>
                      <div class="sqaure" style="width: 15px;height: 15px;border-radius: 50%;background-color: {{sales.color}};">
                      </div>
                    </td>
                    <td> 
                       {{sales.product_category}}
                    </td>
                    <td>
                         <div><span style="font-size: 0.7em;">Ksh.</span>{{sales.total_cost__sum}}</div>
                    </td>
                    <td>
                      {{ sales.percentage }}% 
                    </td>
                  </tr>
                  {% endfor %}
                {% endif %}

              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div>
</div>

  <div class="col-md-12">
      <div class="panel panel-flat">
        <div class="panel-heading">
          <h6 class="panel-title">Cashiers in Terminals</h6>
          <div class="heading-elements">
            <ul class="icons-list">
              <li><a data-action="collapse"></a></li>
              <li><a data-action="reload"></a></li>
              <li><a data-action="close"></a></li>
            </ul>
          </div>
        <a class="heading-elements-toggle"><i class="icon-more"></i></a></div>

        <div class="panel-body">

            <div class="card">

              {% if cashiers %}
                <div class="data-table-container">
                  <table class="table bordered highlight responsive data-table">
                    <thead>
                      <tr>
                        <th>
                          Cashier Name
                        </th>
                        <th class="right-align">
                          Terminal
                        </th>
                        <th> Total Sales</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for user in users %}
                        <tr data-action-go="">
                          <td>
                            {{ user.user__name }} - {{user.user__email}}
                          </td>
                          <td class="right-align">
                            {{ user.terminal }}
                          </td>
                          <td class="right-align">
                            {{ user.total_net__sum }}
                          </td>
                        </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              {% else %}
                <div class="card-content card-content--no-data not-found">
                  <p class="grey-text">
                    {% trans "No products are low in stock." context "Empty low stock table message" %}
                  </p>
                </div>
              {% endif %}
            </div>
          </div>
        </div>

    </div>
   <script type="text/javascript" src="{% static 'backend/js/plugins/ui/chart.js/chart.min.js' %}"></script>
   <script type="text/javascript" src="{% static 'backend/js/plugins/ui/chart.js/utils.js' %}"></script> 
<script type="text/javascript">
$(document).ready(function(){
    // setChart();
    var defaultData = [{% for d in default %} {{ d }}, {% endfor %}];
    var labels = [{% for i in labels %} "{{ i }}", {% endfor %}];
    var ctx = document.getElementById("dateChart").getContext('2d');
    var dateChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Sales in (Kshs)',
                data: defaultData,
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                    'rgba(255,99,132,1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
            }]
        }

    });

    //**@ chart
 var customTooltips = function (tooltip) {
      $(this._chart.canvas).css("cursor", "pointer");

      var positionY = this._chart.canvas.offsetTop;
      var positionX = this._chart.canvas.offsetLeft;

      $(".chartjs-tooltip").css({
        opacity: 0,
      });

      if (!tooltip || !tooltip.opacity) {
        return;
      }

      if (tooltip.dataPoints.length > 0) {
        tooltip.dataPoints.forEach(function (dataPoint) {
          var content = [dataPoint.xLabel, dataPoint.yLabel].join(": ");
          var $tooltip = $("#tooltip-" + dataPoint.datasetIndex);

          $tooltip.html(content);
          $tooltip.css({
            opacity: 1,
            top: positionY + dataPoint.y + "px",
            left: positionX + dataPoint.x + "px",
          });
        });
      }
    };
    var color = Chart.helpers.color;
  // alert(x.substring(0,3));
    var lineChartData = {
      labels: [{% for i in labels2 %} "{{ i }}", {% endfor %}],
      datasets: [{
        label: "This Week",
        backgroundColor: color(window.chartColors.red).alpha(0.2).rgbString(),
        borderColor: window.chartColors.red,
        // pointBackgroundColor: window.chartColors.red,
        fill: false,
        data: [{% for d in default %} {{ d }}, {% endfor %}]
      }, {
        label: "{{prevdate}} Last Week",
        backgroundColor: color(window.chartColors.blue).alpha(0.2).rgbString(),
        borderColor: window.chartColors.blue,
        // pointBackgroundColor: window.chartColors.blue,
        fill:false,
        data: [{% for d in default2 %} {{ d }}, {% endfor %}]
      }]
    };

      var chartEl = document.getElementById("chart1").getContext('2d');
      var chart = new Chart(chartEl, {
        type: "line",
        data: lineChartData,
        options: {
          title:{
            display: true,
            text: "Chart demo"
          },
          tooltips: {
            enabled: false,
            mode: 'index',
            intersect: false,
            custom: customTooltips
          },
          elements: {
            line: {
              tension: 0.000001
            }
          }
        }
      });
//-----chart**/
//**@ doughnut chart
  // function setChart(){
    var defaultData2 = [{% for d in sales_by_category %} {{ d.total_cost__sum }}, {% endfor %}];
    var labels2 = [{% for d in sales_by_category %} "{{ d.product_category }}", {% endfor %}];
    var backColor = [{% for d in sales_by_category %} "{{ d.color }}", {% endfor %}];
    // console.log({% for d in sales_by_category %} "{{ d.color }}", {% endfor %});
      var ctx = document.getElementById("catChart").getContext('2d');
      var myChart = new Chart(ctx, {
          type: 'doughnut',
          data: {
              labels: labels2,
              datasets: [{
                  label: 'Amount of sale',
                  data: defaultData2,
                  backgroundColor:backColor,
                  borderWidth: 1
              }]
          }
      });
  // }
//---------------doghnut chart**/

});
</script>
 {% else %}
  <div class="col-md-12 animated slideInUp ">
   <div class="panel bg-danger-600">
     <div class="panel-body">
       <div style="text-align: center;font-size:16px;">
       No sales summary available for {{date}}
       </div>
      </div>
    </div>
  </div>
 {% endif %}
