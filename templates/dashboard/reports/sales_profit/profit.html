
{% extends "dashboard/base.html" %}
{% load staticfiles i18n %}
{% load i18n %}
{% load prices_i18n %}
{% load humanize %}

{% block title %}
  Sales Profit Report
{% endblock %}
{% block breadcrumbs %}
     <li class="active"><a href="{% url 'dashboard:sales_profit' %}">Sales Profit</a></li>
 {% endblock %}

{% block menu_report_margin_class %}active{% endblock %}
 {% block custom_css %}
 <link href="{% static 'backend/js/plugins/pickers/bootstrap_datepicker/css/bootstrap-datepicker.min.css' %}" rel="stylesheet" type="text/css">
   <style type="text/css">
    label.error{
      color: #FF5722;
    }
    .b-details{padding:0px 10px;}
    .blist{
      list-style: none;
    }
    .blist li{font-size: 1.1em;}
    .hs{border-bottom: 2px solid #ddd;}
    .total-text{padding-left:50px;}
    .total-amount{border-top:1px solid #ddd;border-bottom: 1px solid #ddd;}
    .total-b-texts{}
    .total-b-amount{border-bottom:2px solid #999;}
    .totals{margin-top: 10px;}
    .address-block{font-size: 1.1em}
    .rangeDates{display:none;}
  </style>
 {% endblock %}

{% block content %}

<div class="row animated fadeIn">
       <div class="col-md-12">
      <div class="panel panel-flat">

        <div class="panel-body search-panel">
            <div class="col-md-12">
                <div class="col-md-2">
             <label>Period:</label>
              <div class="form-group">
                 <select class="bootstrap-select period-sz" style="display: none;" data-width="100%" tabindex="-98">
                    <option value="quarter">Quarterly</option>
                    <option value="year">Yearly</option>
                  </select>
              </div>
            </div>
            <div class="col-md-3">
              <label>Ending Month:</label>
              <div class="form-group">
                <div class="input-group">
                  <input class="form-control date-month" type="text" placeholder="mm/yyyy">
                    <input type="hidden" class="hidden-year">
                    <input type="hidden" class="hidden-month">
                  <span class="input-group-addon"><i class="icon-calendar22"></i></span>
                </div>
              </div>
            </div>
            <div class="col-md-2 pull-right">
             <label>Export</label>
              <div class="form-group">
                 <select class="bootstrap-select export-sz" style="display: none;" data-width="100%" tabindex="-98">
                    <option value="none" data-icon="fa fa-dot-circle-o">Option</option>
                    <option value="pdf" data-icon="fa-file-pdf-o">export pdf</option>
                  </select>
              </div>
            </div>
            <div class="col-md-2">
             <label style="visibility:hidden;">Export</label>
              <button class="btn btn-primary btn-block rangeBtn">SEARCH</button>
            </div>
        </div>
      </div>
   </div>
   </div>



{% if status == 'true' %}
<div id="pagination-div">
    <div class="col-md-12">
      <div class="panel panel-flat" id="ss2">

        <div class="panel-body">

            <div class="card">

                <div class="data-table-container">
                  <table class="table bordered highlight responsive data-table">
                    <thead style="border-top:1px solid #ddd;">
                      <tr class="bg-primary">
                        <th class="right-align">
                            <span style="font-weight: bold;">Gross Sales</span>
                        </th>

                          {% for i in dateperiod %}
                              <th class="right-align">
                                  <span class="pull-right">{{ i }}</span>
                              </th>
                          {% endfor %}
                      </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Balance Brought Down</td>
                            {% for i in dateperiod %}
                              <td class="right-align">
                                  <div >
                                      <span class="pull-right">{{ i.totalSales }}</span>
                                </div>
                              </td>
                            {% endfor %}
                        </tr>
                    </tbody>
                  </table>
                </div>
            </div>
          </div>
        </div>

    </div>
<div class="col-md-12">
    <div class="panel panel-flat">
      <div class="panel-body" id="reportBody">
        <div class="row" style="margin-top:0px; padding-top: 0px;">
            <div class="col-md-4 col-md-offset-4" style="margin-top:0px; padding-top: 0px;">
              <img src="{% static 'backend/images/cp-logo2.jpg' %}" class="img-responsive center-block" style="height: 100px;width: auto; ">
               <p class="text-center address-block">
                Company Name.<br />
                P.O Box 23333-00100, Nairobi, Kenya<br />
                Sales Profit<br/>
                As at: {{date}}
               </p>
            </div>
        </div>
            <div class="row">
             <div class="col-md-10 col-md-offset-1">
              <div class="col-md-6 col-md-offset-3">
                 <h3 class="text-center hs">Gross Profit</h3>
                 <div class="b-details">
                   <h5>Profit</h5>
                   <p>
                     <ul class="blist">
                       <li>Total Sales<span class="pull-right"> {{totalSales|intcomma }}</span></li>
                       <li>Total Costs(purchases) <span class="pull-right"> {{totalCostPrice|intcomma }}</span></li>
                     </ul>
                     <p><span class="total-text">Gross Profit</span> <span class="pull-right total-amount">Kshs {{grossProfit}}</span></p>
                   </p>
                 </div>
              </div>
              <!--<div class="col-md-6">-->
                 <!--<h3 class="text-centers hs">Markup</h3>-->
                 <!--<div class="b-details">-->
                   <!--<h5>Net Profit</h5>-->
                   <!--<p>-->
                     <!--<ul class="blist">-->
                       <!--<li>Total Sales <span class="pull-right"> {{totalSales|intcomma }}</span></li>-->
                       <!--<li>Total Costs(Purchases) <span class="pull-right"> {{totalCostPrice|intcomma }}</span></li>-->
                     <!--</ul>-->
                     <!--<p><span class="total-text">Gross Profit</span> <span class="pull-right total-amount">Kshs {{grossProfit|intcomma }}</span></p>-->
                   <!--</p>-->
                 <!--</div>-->
              <!--</div>-->
              <!--<div class="col-md-12 totals">-->
                <!--<div class="col-md-6">-->
                  <!--<div class="b-details">-->
                  <!--<p><span class="total-b-texts">Profit Margin</span> <span class="pull-right total-b-amount">{{margin|intcomma }}%</span></p>-->
                  <!--</div>-->
                <!--</div>-->
                <!--<div class="col-md-6">-->
                  <!--<div class="b-details">-->
                  <!--<p><span class="total-b-texts">Percentage Markup</span> <span class="total-b-amount pull-right">{{markup|intcomma }}%</span></p>-->
                  <!--</div>-->
                <!--</div>-->
              <!--</div>-->
             </div>
            </div>
            <div class="row">
              <div class="col-md-10 col-md-offset-1">
                  <p class="text-center" style="margin: 20px 0px;"> Thank you for partnering with us.<br />
                  <span>Report Pulled By: {% if puller.name %}
                        {{ puller.name | upper }}
                     {% else %}
                        {{ puller.email | upper }}
                     {% endif %}</span></p>

              </div>
             </div>
            </div>


    </div>
  </div>
</div>
     {% else %}
  <div class="col-md-12 animated fadeIn ">
   <div class="panel bg-info">
     <div class="panel-body">
       <div style="text-align: center;font-size:16px;">
          No Sales Profit report available
       </div>
      </div>
    </div>
  </div>
 {% endif %}

</div>


{% endblock%}
{% block custom_js %}
  <script type="text/javascript" src="{% static 'backend/js/plugins/forms/selects/bootstrap_multiselect.js' %}"></script>
  <script type="text/javascript" src="{% static 'backend/js/pages/form_multiselect.js' %}"></script>
<script type="text/javascript" src="{% static 'backend/js/plugins/forms/selects/bootstrap_select.min.js' %}"></script>
<script type="text/javascript" src="{% static 'backend/js/plugins/pickers/bootstrap_datepicker/js/bootstrap-datepicker.min.js' %}"></script>
<script type="text/javascript" src="{% static 'backend/js/plugins/ui/dom-to-image-master/dom-to-image.min.js' %}"></script>
<script type="text/javascript">
var grossUrl = "{% url 'dashboard:sales_profit' %}";

$('.date-month').datepicker({
    format: "MM/yyyy",
    autoclose: true,
    startDate: '{{startMonth}}/{{startYear}}',
    endDate: 'now',
    minViewMode: "months"})
    .on('changeDate', function(e) {
        var month = e.date.getMonth()+1;
        var year = e.date.getFullYear();
        $('.hidden-year').val(year);
        $('.hidden-month').val(month);
    });

$('.rangeBtn').on('click', function(){
    var period = $('.period-sz').find(":selected").val();
    var m = $('.hidden-month').val();
    var y = $('.hidden-year').val();
    $.get(grossUrl,{ajax:'ajax',month:m, year:y, period:period}, function(data){
           $('#pagination-div').html(data);
        });
});

    $('.period-sz').selectpicker({});
    $('.export-sz').selectpicker({
          iconBase: 'fa',
          tickIcon: 'fa-dot-circle-o',
          pdfIcon:'fa-file-pdf-o',
          excelIcon:'fa-file-excel-o'
    }).on('change', function(){

        var ts = $(this).val();
        if(ts == 'pdf'){
            var node = document.getElementById('reportBody')
                    domtoimage.toPng(node)
                    .then(function (dataUrl) {
                        var img = new Image();
                        img.src = dataUrl;
                       $.get(grossUrl,{pdf:'pdf',image:dataUrl}, function(data){
                            window.open("data:application/pdf," + escape(data));
                        });
                    }).catch(function (error) {
                        console.error('oops, something went wrong!', error);
                    });
         }
    });
</script>
{% endblock %}