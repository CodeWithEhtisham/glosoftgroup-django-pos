{% load staticfiles %}
<style>
  .error{
    color:#E64A19;
  }
</style>
<!-- Blue modal -->
  <div id="modal_type" class="modal fade" data-modal-index="1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-blue">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title mt1 text-white text-center"></h4>
        </div>
        <div id='modal_type_results'>
                  <button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#test-modal">
                    <i class="icon-file-plus"></i> Show Another
                </button>
        <div class="modal-body" id="modal_type_body">

        </div>

        <div class="modal-footer">

        </div>
        </div>

      </div>
    </div>
  </div>
  <!-- /blue modal -->

  <div class="modal fade" id="test-modal" data-modal-index="2">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-blue">
        <button type="button" class="close" data-dismiss="modal">
          <span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
        </button>
        <h4 class="modal-title mt2 text-center">Add Attribute</h4>
      </div>
      <form method="post" enctype="multipart/form-data" id="attr-form" name="attr-form">
        {% csrf_token %}
        <div class="modal-body" id="category_modal_body">
          <div class="row">
              <div class="form-group">
                <label>Attribute Name</label>
                 <input class="form-control" name="attribute"/>
              </div>
              <div class="form-group">
                  <label>Add Values</label>
                  <div id="attr-values">
                    <div class="parent-value col-md-6">
                      <div class="col-md-10">
                        <input class="form-control pull-left the-value"/>
                      </div>
                      <div class="col-md-2">
                      <button type="button" class="close-value close pull-right">&times;</button>
                      </div>
                    </div>
                  </div>

              </div>
              <div class="col-md-12" style="margin-top:20px;">
                  <button type="button" class="btn btn-primary" id="val-btn">Add New Value</button>
              </div>
          </div>

        </div>
        <div class="modal-footer">
          <div class="col-md-6 col-md-offset-3">
            <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary pull-right">Save changes</button>
          </div>
        </div>
      </form>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
  <script type="text/javascript" src="{% static 'backend/js/jquery-1.11.3.min.js' %}"></script>
<script type="text/javascript">
  $( document ).ready(function() {

     //** remove a value
     $('body').on( 'click', '.close-value', function(){
        $(this).parent().parent().remove();
     });

     //** add a new value
     $('#val-btn').on('click', function(e){
         var value_input = '<div class="parent-value col-md-6">'+
                            '<div class="col-md-10">'+
                              '<input class="form-control pull-left the-value"/>'+
                            '</div>'+
                            '<div class="col-md-2">'+
                            '<button type="button" class="close-value close pull-right">&times;</button>'+
                            '</div>'+
                          '</div>'
         $('#attr-values').append(value_input);
      });

    // validate
    $('#attr-form').validate({
      onkeyup: function(element) {$(element).valid()},
      rules:{
          attribute: {
            required:true
          }
      },
      messages:{
        attribute:{
          required: "please provide an attribute name",
        },
      },
      submitHandler: function() {

          values = [];
          $(".the-value").each(function() {
              vl = $(this).val();
              values.push(vl);
          });
        var f = document.getElementById('attr-form');
        var formData = new FormData(f);
        for (var i = 0; i < values.length; i++) {
            formData.append('values', values[i]);
        }
        if (formData) {
              $.ajax({
                  url: "{% url 'dashboard:product-attribute-add-modal' %}",
                  type: "POST",
                  data: formData,
                  processData: false,
                  contentType: false,
                  success:function(data){
                     console.log(data);
                     $('.new-attr').html(data);
                     $('#test-modal').modal('hide');
                     $.jGrowl('Attribute added successfully,', {
                        header: 'Well done!',
                        theme: 'bg-success'
                     });
                  },
                  error:function(error){
                    console.log(error);
                    $.jGrowl('Change a few things up and try submitting again', {
                        header: 'Oh snap!',
                        theme: 'bg-danger'
                    });
                  }
              });
          }
      }
  });
    // end validate
  });

</script>


